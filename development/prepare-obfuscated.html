<!DOCTYPE html>
<html>
<head>
  <title>Obfuscate The Pretty</title>
  <script src="/development/prepared/pretty.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/javascript-obfuscator/dist/index.browser.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.9.0/beautify.min.js"></script>
  <style>pre{ font: .6em "Lucida Console"; white-space: pre-wrap; }</style>
</head>
<body>
  <div id="main"></div>
  <script>
    /* global JavaScriptObfuscator */
    /* global js_beautify */
    
    const FNAMES = {
      send_and_encr : [
          "_0x26af06", "_0x3c8c4d",
          "_0x57c4a4", "_0x4d213f",
          "_0x339cc3", "_0x5ce2b4",
          
          "_0x3b34b6", "_0x2289de",
          "_0x2afb42", "_0x1f459e",
          "_0x58b5a0", "_0x3e2335",
          
          "_0x1dd754", "_0x5ca3f3",
          "_0x325def", "_0x108c44",
          "_0x298ad1", "_0x3c42cb",
          
          "_0x1e8c37", "_0x498b55",
          "_0x12c1bc", "_0x2e8af2",
          "_0x1c6d06", "_0x19bc49",
        ]
    }
    
    function loadfile(path) 
    {
      let http = new XMLHttpRequest()
      http.open("GET", path, false)
      http.send(null)
      return http.responseText
    }
    
    function obfuscateSomeMore( code )
    {
      for ( let i = 0; i < 12; i++ )
      {
        let f_encr = FNAMES.send_and_encr[ i*2 ]
        let f_send = FNAMES.send_and_encr[ i*2 + 1 ]
        code = code.replace("encrypt_score_"+(i+1),f_encr)
        code = code.replace("send_score_"+(i+1),f_send)
      }
      
      return code
    }

    function save(code) 
    {
      let http = new XMLHttpRequest()
      http.open("POST", `/development/prepared/unpretty-set.php`, false)
      http.send(code)
      output( http.responseText )
    }
    
    function output(code)
    {
      code = js_beautify( code )
      let pre = document.createElement("pre")
      pre.textContent = code
      document.body.appendChild(pre)
    }
    
    let pretty = loadfile(`/development/prepared/pretty.js`)
    
    let options = { 
      debugProtection: true,
      renameGlobals: false,
      reservedNames: ["^send_score_","^encrypt_score_"],
      reservedStrings: [],
      deadCodeInjection: true,
      deadCodeInjectionThreshold: 0.6,
      
      compact: true,
      controlFlowFlattening: true,
      controlFlowFlatteningThreshold: 0.75,
      debugProtectionInterval: false,
      disableConsoleOutput: false,
      domainLock: [],
      identifierNamesGenerator: 'mangled',
      identifiersPrefix: '',
      inputFileName: '',
      log: false,
      rotateStringArray: true,
      seed: 0,
      selfDefending: false,
      sourceMap: false,
      sourceMapBaseUrl: '',
      sourceMapFileName: '',
      sourceMapMode: 'separate',
      stringArray: true,
      stringArrayEncoding: 'rc4',
      stringArrayThreshold: 1.00,
      target: 'browser',
      transformObjectKeys: true,
      unicodeEscapeSequence: true
    }
    
    // var JavaScriptObfuscator = require('javascript-obfuscator');
    let obfuscationResult = JavaScriptObfuscator.obfuscate( pretty, options )
    let unpretty = obfuscationResult.getObfuscatedCode()
    unpretty = obfuscateSomeMore( unpretty )
      
    save( unpretty )
    
  </script>
</body>
</html>